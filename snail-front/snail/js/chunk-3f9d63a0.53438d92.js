(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3f9d63a0"],{"29fc":function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"search"},[s("Card",[s("Row",{staticClass:"operation"},[s("Button",{directives:[{name:"show",rawName:"v-show",value:"tree"==t.showType,expression:"showType == 'tree'"}],attrs:{type:"primary",icon:"md-add"},on:{click:t.add}},[t._v("添加子部门")]),s("Button",{attrs:{icon:"md-add"},on:{click:t.addRoot}},[t._v("添加一级部门")]),s("Button",{attrs:{icon:"md-trash"},on:{click:t.delAll}},[t._v("批量删除")]),s("Button",{attrs:{icon:"md-refresh"},on:{click:t.getParentList}},[t._v("刷新")]),s("Input",{directives:[{name:"show",rawName:"v-show",value:"list"==t.showType,expression:"showType == 'list'"}],staticStyle:{width:"250px"},attrs:{suffix:"ios-search",placeholder:"输入部门名搜索",clearable:""},on:{"on-change":t.search},model:{value:t.searchKey,callback:function(e){t.searchKey=e},expression:"searchKey"}}),s("i-switch",{directives:[{name:"show",rawName:"v-show",value:"tree"==t.showType,expression:"showType == 'tree'"}],staticStyle:{"margin-left":"5px"},attrs:{size:"large"},model:{value:t.strict,callback:function(e){t.strict=e},expression:"strict"}},[s("span",{attrs:{slot:"open"},slot:"open"},[t._v("级联")]),s("span",{attrs:{slot:"close"},slot:"close"},[t._v("单选")])]),s("div",{staticStyle:{float:"right"}},[s("RadioGroup",{attrs:{type:"button"},model:{value:t.showType,callback:function(e){t.showType=e},expression:"showType"}},[s("Radio",{attrs:{title:"树结构",label:"tree"}},[s("Icon",{attrs:{type:"md-list"}})],1),s("Radio",{attrs:{title:"列表",label:"list"}},[s("Icon",{attrs:{type:"ios-apps"}})],1)],1)],1)],1),s("Row",{directives:[{name:"show",rawName:"v-show",value:"tree"==t.showType,expression:"showType == 'tree'"}],attrs:{type:"flex",justify:"start",gutter:16}},[s("Col",{attrs:{sm:8,md:8,lg:8,xl:6}},[s("Alert",{attrs:{"show-icon":""}},[t._v(" 当前选择编辑： "),s("span",{staticClass:"select-title"},[t._v(t._s(t.editTitle))]),t.form.id?s("a",{staticClass:"select-clear",on:{click:t.cancelEdit}},[t._v("取消选择")]):t._e()]),s("Input",{attrs:{suffix:"ios-search",placeholder:"输入部门名搜索",clearable:""},on:{"on-change":t.search},model:{value:t.searchKey,callback:function(e){t.searchKey=e},expression:"searchKey"}}),s("div",{staticClass:"tree-bar",style:{maxHeight:t.maxHeight}},[s("Tree",{ref:"tree",attrs:{data:t.data,"load-data":t.loadData,"show-checkbox":"","check-strictly":!t.strict},on:{"on-check-change":t.changeSelect,"on-select-change":t.selectTree}}),t.loading?s("Spin",{attrs:{size:"large",fix:""}}):t._e()],1)],1),s("Col",{attrs:{sm:16,md:16,lg:16,xl:9}},[s("Form",{ref:"form",attrs:{model:t.form,"label-width":100,rules:t.formValidate}},[s("FormItem",{attrs:{label:"上级部门",prop:"parentTitle"}},[s("div",{staticStyle:{display:"flex"}},[s("Input",{staticStyle:{"margin-right":"10px"},attrs:{readonly:""},model:{value:t.form.parentTitle,callback:function(e){t.$set(t.form,"parentTitle",e)},expression:"form.parentTitle"}}),s("Poptip",{attrs:{transfer:"",trigger:"click",placement:"right-start",title:"选择上级部门",width:"250"}},[s("Button",{attrs:{icon:"md-list"}},[t._v("选择部门")]),s("div",{staticStyle:{position:"relative","min-height":"5vh"},attrs:{slot:"content"},slot:"content"},[s("Tree",{attrs:{data:t.dataEdit,"load-data":t.loadData},on:{"on-select-change":t.selectTreeEdit}}),t.loadingEdit?s("Spin",{attrs:{size:"large",fix:""}}):t._e()],1)],1)],1)]),s("FormItem",{attrs:{label:"部门名称",prop:"title"}},[s("Input",{model:{value:t.form.title,callback:function(e){t.$set(t.form,"title",e)},expression:"form.title"}})],1),s("FormItem",{attrs:{label:"部门负责人",prop:"mainHeader"}},[s("Select",{attrs:{loading:t.userLoading,"not-found-text":"该部门暂无用户数据",multiple:"",filterable:"",placeholder:"请选择或输入搜索用户"},model:{value:t.form.mainHeader,callback:function(e){t.$set(t.form,"mainHeader",e)},expression:"form.mainHeader"}},t._l(t.users,(function(e){return s("Option",{key:e.id,attrs:{value:e.id,label:e.nickname}},[s("span",{staticStyle:{"margin-right":"10px"}},[t._v(t._s(e.nickname))]),s("span",{staticStyle:{color:"#ccc"}},[t._v(t._s(e.username))])])})),1)],1),s("FormItem",{attrs:{label:"副负责人",prop:"viceHeader"}},[s("Select",{attrs:{loading:t.userLoading,"not-found-text":"该部门暂无用户数据",multiple:"",filterable:"",placeholder:"请选择或输入搜索用户"},model:{value:t.form.viceHeader,callback:function(e){t.$set(t.form,"viceHeader",e)},expression:"form.viceHeader"}},t._l(t.users,(function(e){return s("Option",{key:e.id,attrs:{value:e.id,label:e.nickname}},[s("span",{staticStyle:{"margin-right":"10px"}},[t._v(t._s(e.nickname))]),s("span",{staticStyle:{color:"#ccc"}},[t._v(t._s(e.username))])])})),1)],1),s("FormItem",{attrs:{label:"排序值",prop:"sortOrder"}},[s("Tooltip",{attrs:{trigger:"hover",placement:"right",content:"值越小越靠前，支持小数"}},[s("InputNumber",{attrs:{max:1e3,min:0},model:{value:t.form.sortOrder,callback:function(e){t.$set(t.form,"sortOrder",e)},expression:"form.sortOrder"}})],1)],1),s("FormItem",{attrs:{label:"是否启用",prop:"status"}},[s("i-switch",{attrs:{size:"large","true-value":0,"false-value":-1},model:{value:t.form.status,callback:function(e){t.$set(t.form,"status",e)},expression:"form.status"}},[s("span",{attrs:{slot:"open"},slot:"open"},[t._v("启用")]),s("span",{attrs:{slot:"close"},slot:"close"},[t._v("禁用")])])],1),s("FormItem",{staticClass:"br"},[s("Button",{attrs:{loading:t.submitLoading,type:"primary",icon:"ios-create-outline"},on:{click:t.submitEdit}},[t._v("修改并保存")]),s("Button",{on:{click:t.handleReset}},[t._v("重置")])],1)],1)],1)],1),s("Alert",{directives:[{name:"show",rawName:"v-show",value:"list"==t.showType,expression:"showType == 'list'"}],attrs:{"show-icon":""}},[t._v(" 已选择 "),s("span",{staticClass:"select-count"},[t._v(t._s(t.selectList.length))]),t._v(" 项 "),s("a",{staticClass:"select-clear",on:{click:t.clearSelectAll}},[t._v("清空")])]),"list"==t.showType?s("Table",{ref:"table",attrs:{"row-key":"title","load-data":t.loadData,columns:t.columns,data:t.data,loading:t.loading,border:""},on:{"on-selection-change":t.showSelect}}):t._e()],1),s("Modal",{attrs:{title:t.modalTitle,"mask-closable":!1,width:500},model:{value:t.modalVisible,callback:function(e){t.modalVisible=e},expression:"modalVisible"}},[s("Form",{ref:"formAdd",attrs:{model:t.formAdd,"label-width":85,rules:t.formValidate}},[t.showParent?s("div",[s("FormItem",{attrs:{label:"上级部门："}},[t._v(t._s(t.form.title))])],1):t._e(),s("FormItem",{attrs:{label:"部门名称",prop:"title"}},[s("Input",{model:{value:t.formAdd.title,callback:function(e){t.$set(t.formAdd,"title",e)},expression:"formAdd.title"}})],1),s("FormItem",{attrs:{label:"排序值",prop:"sortOrder"}},[s("Tooltip",{attrs:{trigger:"hover",placement:"right",content:"值越小越靠前，支持小数"}},[s("InputNumber",{attrs:{max:1e3,min:0},model:{value:t.formAdd.sortOrder,callback:function(e){t.$set(t.formAdd,"sortOrder",e)},expression:"formAdd.sortOrder"}})],1)],1),s("FormItem",{attrs:{label:"是否启用",prop:"status"}},[s("i-switch",{attrs:{size:"large","true-value":0,"false-value":-1},model:{value:t.formAdd.status,callback:function(e){t.$set(t.formAdd,"status",e)},expression:"formAdd.status"}},[s("span",{attrs:{slot:"open"},slot:"open"},[t._v("启用")]),s("span",{attrs:{slot:"close"},slot:"close"},[t._v("禁用")])])],1)],1),s("div",{attrs:{slot:"footer"},slot:"footer"},[s("Button",{attrs:{type:"text"},on:{click:t.cancelAdd}},[t._v("取消")]),s("Button",{attrs:{type:"primary",loading:t.submitLoading},on:{click:t.submitAdd}},[t._v("提交")])],1)],1)],1)},a=[],r=s("365c"),o={name:"department-manage",data:function(){var t=this;return{showType:"tree",loading:!0,maxHeight:"500px",strict:!0,userLoading:!1,loadingEdit:!0,modalVisible:!1,selectList:[],showParent:!1,modalTitle:"",editTitle:"",searchKey:"",form:{id:"",title:null,parentId:"",parentTitle:"",sortOrder:0,status:0},formAdd:{},formValidate:{title:[{required:!0,message:"名称不能为空",trigger:"change"}],sortOrder:[{required:!0,type:"number",message:"排序值不能为空",trigger:"change"}]},submitLoading:!1,data:[],dataEdit:[],users:[],columns:[{type:"selection",width:60,align:"center"},{type:"index",width:60,align:"center"},{title:"部门名称",key:"title",minWidth:120,sortable:!0,tree:!0},{title:"排序",key:"sortOrder",width:150,sortable:!0,align:"center",sortType:"asc"},{title:"创建时间",key:"createTime",sortable:!0,width:200},{title:"操作",key:"action",width:300,align:"center",render:function(e,s){return e("div",[e("a",{on:{click:function(){t.tableAdd(s.row)}}},"添加子部门"),e("Divider",{props:{type:"vertical"}}),e("a",{on:{click:function(){t.remove(s.row)}}},"删除")])}}]}},methods:{init:function(){this.getParentList(),this.getParentListEdit()},getParentList:function(){var t=this;this.loading=!0,Object(r["tc"])().then((function(e){t.loading=!1,e.success&&(e.result.forEach((function(t){t.isParent&&(t.loading=!1,t.children=[],t._loading=!1)})),t.data=e.result)}))},getParentListEdit:function(){var t=this;this.loadingEdit=!0,Object(r["tc"])().then((function(e){if(t.loadingEdit=!1,e.success){e.result.forEach((function(t){t.isParent&&(t.loading=!1,t.children=[])}));var s={id:"0",title:"一级部门"};e.result.unshift(s),t.dataEdit=e.result}}))},loadData:function(t,e){Object(r["vc"])(t.id).then((function(t){t.success&&(t.result.forEach((function(t){t.isParent&&(t.loading=!1,t.children=[],t._loading=!1)})),e(t.result))}))},search:function(){var t=this;this.searchKey?(this.loading=!0,Object(r["Ic"])({title:this.searchKey}).then((function(e){t.loading=!1,e.success&&(e.result.forEach((function(t){t.isParent&&(t.loading=!1,t.children=[],t._loading=!1)})),t.data=e.result)}))):this.getParentList()},selectTree:function(t){var e=this;if(t.length>0){for(var s in t[0])null==t[0][s]&&(t[0][s]="");var i=JSON.stringify(t[0]),a=JSON.parse(i);this.editTitle=a.title,this.userLoading=!0,Object(r["nc"])(a.id).then((function(t){e.userLoading=!1,t.success&&(e.users=t.result,e.form=a)}))}else this.cancelEdit()},cancelEdit:function(){var t=this.$refs.tree.getSelectedNodes()[0];t&&(t.selected=!1),this.$refs.form.resetFields(),delete this.form.id,this.editTitle=""},selectTreeEdit:function(t){if(t.length>0){for(var e in t[0])null==t[0][e]&&(t[0][e]="");var s=JSON.stringify(t[0]),i=JSON.parse(s);this.form.parentId=i.id,this.form.parentTitle=i.title}},cancelAdd:function(){this.modalVisible=!1},handleReset:function(){this.$refs.form.resetFields(),this.form.status=0},showSelect:function(t){this.selectList=t},clearSelectAll:function(){this.$refs.table.selectAll(!1)},submitEdit:function(){var t=this;this.$refs.form.validate((function(e){if(e){if(!t.form.id)return void t.$Message.warning("请先点击选择要修改的部门");t.submitLoading=!0,Object(r["bb"])(t.form).then((function(e){t.submitLoading=!1,e.success&&(t.$Message.success("编辑成功"),t.init(),t.modalVisible=!1)}))}}))},submitAdd:function(){var t=this;this.$refs.formAdd.validate((function(e){e&&(t.submitLoading=!0,Object(r["g"])(t.formAdd).then((function(e){t.submitLoading=!1,e.success&&(t.$Message.success("添加成功"),t.init(),t.modalVisible=!1)})))}))},tableAdd:function(t){this.form=t,this.add()},add:function(){""!=this.form.id&&null!=this.form.id?(this.modalTitle="添加子部门",this.showParent=!0,this.formAdd={parentId:this.form.id,sortOrder:0,status:0},this.modalVisible=!0):this.$Message.warning("请先点击选择一个部门")},addRoot:function(){this.modalTitle="添加一级部门",this.showParent=!1,this.formAdd={parentId:0,sortOrder:0,status:0},this.modalVisible=!0},changeSelect:function(t){this.selectList=t},remove:function(t){this.selectList=[],this.selectList.push(t),this.delAll()},delAll:function(){var t=this;this.selectList.length<=0?this.$Message.warning("您还未勾选要删除的数据"):this.$Modal.confirm({title:"确认删除",content:"您确认要删除所选的 "+this.selectList.length+" 条数据及其下级所有数据?",loading:!0,onOk:function(){var e="";t.selectList.forEach((function(t){e+=t.id+","})),e=e.substring(0,e.length-1),Object(r["F"])({ids:e}).then((function(e){t.$Modal.remove(),e.success&&(t.$Message.success("删除成功"),t.selectList=[],t.cancelEdit(),t.init())}))}})}},mounted:function(){var t=document.documentElement.clientHeight;this.maxHeight=Number(t-287)+"px",this.init()}},l=o,n=(s("83ea"),s("2877")),c=Object(n["a"])(l,i,a,!1,null,null,null);e["default"]=c.exports},"5ff7":function(t,e,s){},"83ea":function(t,e,s){"use strict";s("5ff7")}}]);