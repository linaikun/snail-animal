(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-43af9f31"],{2798:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"search"},[i("Card",[i("Row",{staticClass:"operation"},[i("Button",{attrs:{type:"primary",icon:"md-add"},on:{click:e.addRole}},[e._v("添加角色")]),i("Button",{attrs:{icon:"md-trash"},on:{click:e.delAll}},[e._v("批量删除")]),i("Button",{attrs:{icon:"md-refresh"},on:{click:e.init}},[e._v("刷新")]),i("Button",{attrs:{type:"dashed"},on:{click:function(t){e.openTip=!e.openTip}}},[e._v(e._s(e.openTip?"关闭提示":"开启提示"))]),i("Input",{staticStyle:{width:"250px"},attrs:{suffix:"ios-search",placeholder:"输入关键词搜索",clearable:""},on:{"on-change":e.getDataList},model:{value:e.searchForm.key,callback:function(t){e.$set(e.searchForm,"key",t)},expression:"searchForm.key"}})],1),i("Row",{directives:[{name:"show",rawName:"v-show",value:e.openTip,expression:"openTip"}]},[i("Alert",{attrs:{"show-icon":""}},[e._v(" 已选择 "),i("span",{staticClass:"select-count"},[e._v(e._s(e.selectList.length))]),e._v(" 项 "),i("a",{staticClass:"select-clear",on:{click:e.clearSelectAll}},[e._v("清空")])])],1),i("Row",[i("Table",{ref:"table",attrs:{loading:e.loading,border:"",columns:e.columns,data:e.data,sortable:"custom"},on:{"on-sort-change":e.changeSort,"on-selection-change":e.changeSelect}})],1),i("Row",{staticClass:"page",attrs:{type:"flex",justify:"end"}},[i("Page",{attrs:{current:e.searchForm.pageNumber,total:e.total,"page-size":e.searchForm.pageSize,"page-size-opts":[10,20,50],size:"small","show-total":"","show-elevator":"","show-sizer":""},on:{"on-change":e.changePage,"on-page-size-change":e.changePageSize}})],1)],1),i("Modal",{attrs:{title:e.modalTitle,"mask-closable":!1,width:500},model:{value:e.roleModalVisible,callback:function(t){e.roleModalVisible=t},expression:"roleModalVisible"}},[i("Form",{ref:"roleForm",attrs:{model:e.roleForm,"label-width":80,rules:e.roleFormValidate}},[i("FormItem",{attrs:{label:"角色名称",prop:"name"}},[i("Input",{attrs:{placeholder:"按照Spring Security约定建议以‘ROLE_’开头"},model:{value:e.roleForm.name,callback:function(t){e.$set(e.roleForm,"name",t)},expression:"roleForm.name"}})],1),i("FormItem",{attrs:{label:"备注",prop:"description"}},[i("Input",{model:{value:e.roleForm.description,callback:function(t){e.$set(e.roleForm,"description",t)},expression:"roleForm.description"}})],1)],1),i("div",{attrs:{slot:"footer"},slot:"footer"},[i("Button",{attrs:{type:"text"},on:{click:e.cancelRole}},[e._v("取消")]),i("Button",{attrs:{type:"primary",loading:e.submitLoading},on:{click:e.submitRole}},[e._v("提交")])],1)],1),i("Modal",{staticClass:"permModal",attrs:{title:e.modalTitle,"mask-closable":!1,width:500,styles:{top:"30px"}},model:{value:e.permModalVisible,callback:function(t){e.permModalVisible=t},expression:"permModalVisible"}},[i("div",{staticStyle:{position:"relative"}},[i("Tree",{ref:"tree",attrs:{data:e.permData,"show-checkbox":"",render:e.renderContent,"check-strictly":!0}}),e.treeLoading?i("Spin",{attrs:{size:"large",fix:""}}):e._e()],1),i("div",{attrs:{slot:"footer"},slot:"footer"},[i("Button",{attrs:{type:"text"},on:{click:e.cancelPermEdit}},[e._v("取消")]),i("Select",{staticStyle:{width:"110px","text-align":"left","margin-right":"10px"},on:{"on-change":e.changeOpen},model:{value:e.openLevel,callback:function(t){e.openLevel=t},expression:"openLevel"}},[i("Option",{attrs:{value:"0"}},[e._v("展开所有")]),i("Option",{attrs:{value:"1"}},[e._v("收合所有")]),i("Option",{attrs:{value:"2"}},[e._v("仅展开一级")]),i("Option",{attrs:{value:"3"}},[e._v("仅展开两级")])],1),i("Button",{on:{click:e.selectTreeAll}},[e._v("全选/反选")]),i("Button",{attrs:{type:"primary",loading:e.submitPermLoading},on:{click:e.submitPermEdit}},[e._v("提交")])],1)]),i("Modal",{staticClass:"depModal",attrs:{title:e.modalTitle,"mask-closable":!1,width:500},model:{value:e.depModalVisible,callback:function(t){e.depModalVisible=t},expression:"depModalVisible"}},[i("Alert",{attrs:{"show-icon":""}},[e._v("默认可查看全部数据，自定义数据范围时请勾选下方数据")]),i("Form",{attrs:{"label-width":85}},[i("FormItem",{attrs:{label:"数据范围"}},[i("Select",{attrs:{transfer:""},model:{value:e.dataType,callback:function(t){e.dataType=t},expression:"dataType"}},[i("Option",{attrs:{value:0}},[e._v("全部数据权限")]),i("Option",{attrs:{value:1}},[e._v("自定义数据权限")]),i("Option",{attrs:{value:2}},[e._v("本部门及以下数据权限")]),i("Option",{attrs:{value:3}},[e._v("本部门数据权限")])],1)],1)],1),i("div",{directives:[{name:"show",rawName:"v-show",value:1==e.dataType,expression:"dataType == 1"}],staticStyle:{"margin-top":"15px"}},[i("div",{staticStyle:{position:"relative"}},[i("Tree",{ref:"depTree",staticStyle:{"margin-top":"15px"},attrs:{data:e.depData,"load-data":e.loadData,multiple:""},on:{"on-toggle-expand":e.expandCheckDep}}),e.depTreeLoading?i("Spin",{attrs:{size:"large",fix:""}}):e._e()],1)]),i("div",{attrs:{slot:"footer"},slot:"footer"},[i("Button",{attrs:{type:"text"},on:{click:function(t){e.depModalVisible=!1}}},[e._v("取消")]),i("Button",{attrs:{type:"primary",loading:e.submitDepLoading},on:{click:e.submitDepEdit}},[e._v("提交")])],1)],1)],1)},n=[],s=i("365c"),o=i("c276"),l={name:"role-manage",data:function(){var e=this;return{openTip:!0,openLevel:"0",loading:!0,treeLoading:!0,depTreeLoading:!0,submitPermLoading:!1,submitDepLoading:!1,searchKey:"",sortColumn:"createTime",sortType:"desc",modalType:0,roleModalVisible:!1,permModalVisible:!1,depModalVisible:!1,modalTitle:"",searchForm:{pageNumber:1,pageSize:10,sort:"createTime",order:"desc",key:""},roleForm:{name:"",description:""},roleFormValidate:{name:[{required:!0,message:"角色名称不能为空",trigger:"change"}]},submitLoading:!1,selectList:[],columns:[{type:"selection",width:60,align:"center"},{type:"index",width:60,align:"center"},{title:"角色名称",key:"name",width:150,sortable:!0},{title:"备注",key:"description",minWidth:150,sortable:!0},{title:"创建时间",key:"createTime",width:170,sortable:!0,sortType:"desc"},{title:"更新时间",key:"updateTime",width:170,sortable:!0},{title:"设置为注册用户默认角色",key:"defaultRole",align:"center",width:200,render:function(t,i){return i.row.defaultRole?t("div",[t("Checkbox",{props:{value:!0},on:{"on-change":function(){e.cancelDefault(i.row)}}})]):t("div",[t("Checkbox",{props:{value:!1},on:{"on-change":function(){e.setDefault(i.row)}}})])}},{title:"操作",key:"action",align:"center",fixed:"right",width:280,render:function(t,i){return t("div",[t("a",{on:{click:function(){e.editPerm(i.row)}}},"菜单权限"),t("Divider",{props:{type:"vertical"}}),t("a",{on:{click:function(){e.editDep(i.row)}}},"数据权限"),t("Divider",{props:{type:"vertical"}}),t("a",{on:{click:function(){e.edit(i.row)}}},"编辑"),t("Divider",{props:{type:"vertical"}}),t("a",{on:{click:function(){e.remove(i.row)}}},"删除")])}}],data:[],total:0,permData:[],editRolePermId:"",selectAllFlag:!1,depData:[],dataType:0,editDepartments:[]}},methods:{init:function(){this.getDataList(),this.getPermList()},renderContent:function(e,t){t.root,t.node;var i=t.data,a="";return a=0==i.level?"ios-navigate":1==i.level?"md-list-box":2==i.level?"md-list":3==i.level?"md-radio-button-on":"md-radio-button-off",e("span",{style:{display:"inline-block",cursor:"pointer"},on:{click:function(){i.checked=!i.checked}}},[e("span",[e("Icon",{props:{type:a,size:"16"},style:{"margin-right":"8px","margin-bottom":"3px"}}),e("span",i.title)])])},changePage:function(e){this.searchForm.pageNumber=e,this.getDataList(),this.clearSelectAll()},changePageSize:function(e){this.searchForm.pageSize=e,this.getDataList()},changeSort:function(e){this.searchForm.sort=e.key,this.searchForm.order=e.order,"normal"==e.order&&(this.searchForm.order=""),this.getDataList()},getDataList:function(){var e=this;this.loading=!0,Object(s["ic"])(this.searchForm).then((function(t){e.loading=!1,t.success&&(e.data=t.result.content,e.total=t.result.totalElements,0==e.data.length&&e.searchForm.pageNumber>1&&(e.searchForm.pageNumber-=1,e.getDataList()))}))},getPermList:function(){var e=this;this.treeLoading=!0,Object(s["Db"])().then((function(t){t.success&&(e.deleteDisableNode(t.result),e.permData=t.result,e.treeLoading=!1),e.treeLoading=!1}))},deleteDisableNode:function(e){var t=this;e.forEach((function(e){-1==e.status&&(e.title="[已禁用] "+e.title,e.disabled=!0),e.children&&e.children.length>0&&t.deleteDisableNode(e.children)}))},cancelRole:function(){this.roleModalVisible=!1},submitRole:function(){var e=this;this.$refs.roleForm.validate((function(t){t&&(0==e.modalType?(e.submitLoading=!0,Object(s["m"])(e.roleForm).then((function(t){e.submitLoading=!1,t.success&&(e.$Message.success("操作成功"),e.getDataList(),e.roleModalVisible=!1)}))):(e.submitLoading=!0,Object(s["nb"])(e.roleForm).then((function(t){e.submitLoading=!1,t.success&&(e.$Message.success("操作成功"),e.getDataList(),e.roleModalVisible=!1)}))))}))},addRole:function(){this.modalType=0,this.modalTitle="添加角色",this.$refs.roleForm.resetFields(),delete this.roleForm.id,this.roleModalVisible=!0},edit:function(e){for(var t in this.modalType=1,this.modalTitle="编辑角色",this.$refs.roleForm.resetFields(),e)null==e[t]&&(e[t]="");var i=JSON.stringify(e),a=JSON.parse(i);this.roleForm=a,this.roleModalVisible=!0},remove:function(e){var t=this;this.$Modal.confirm({title:"确认删除",content:"您确认要删除角色 "+e.name+" ?",loading:!0,onOk:function(){Object(s["O"])({ids:e.id}).then((function(e){t.$Modal.remove(),e.success&&(t.clearSelectAll(),t.$Message.success("删除成功"),t.getDataList())}))}})},setDefault:function(e){var t=this;this.loading=!0;var i={id:e.id,isDefault:!0};Object(s["Tc"])(i).then((function(e){t.loading=!1,e.success&&(t.$Message.success("操作成功"),t.getDataList())}))},cancelDefault:function(e){var t=this;this.loading=!0;var i={id:e.id,isDefault:!1};Object(s["Tc"])(i).then((function(e){t.loading=!1,e.success&&(t.$Message.success("操作成功"),t.getDataList())}))},clearSelectAll:function(){this.$refs.table.selectAll(!1)},changeSelect:function(e){this.selectList=e},delAll:function(){var e=this;this.selectList.length<=0?this.$Message.warning("您还未选择要删除的数据"):this.$Modal.confirm({title:"确认删除",content:"您确认要删除所选的 "+this.selectList.length+" 条数据?",loading:!0,onOk:function(){var t="";e.selectList.forEach((function(e){t+=e.id+","})),t=t.substring(0,t.length-1),Object(s["O"])({ids:t}).then((function(t){e.$Modal.remove(),t.success&&(e.$Message.success("删除成功"),e.clearSelectAll(),e.getDataList())}))}})},editPerm:function(e){this.editRolePermId=e.id,this.modalTitle="分配 "+e.name+" 的菜单权限";var t=e.permissions;this.treeLoading?this.$Message.warning("菜单权限数据加载中，请稍后点击查看"):(this.checkPermTree(this.permData,t),this.permModalVisible=!0)},checkPermTree:function(e,t){var i=this;e.forEach((function(e){i.hasPerm(e,t)&&-1!=e.status?e.checked=!0:e.checked=!1,e.children&&e.children.length>0&&i.checkPermTree(e.children,t)}))},hasPerm:function(e,t){for(var i=!1,a=0;a<t.length;a++)if(e.id==t[a].permissionId){i=!0;break}return!!i},selectTreeAll:function(){this.selectAllFlag=!this.selectAllFlag;var e=this.selectAllFlag;this.selectedTreeAll(this.permData,e)},selectedTreeAll:function(e,t){var i=this;e.forEach((function(e){e.checked=t,e.children&&e.children.length>0&&i.selectedTreeAll(e.children,t)}))},submitPermEdit:function(){var e=this;this.submitPermLoading=!0;var t="",i=this.$refs.tree.getCheckedNodes();i.forEach((function(e){t+=e.id+","})),t=t.substring(0,t.length-1),Object(s["pb"])({roleId:this.editRolePermId,permIds:t}).then((function(t){e.submitPermLoading=!1,t.success&&(e.$Message.success("操作成功"),e.$store.commit("setAdded",!1),o["a"].initRouter(e),e.getDataList(),e.permModalVisible=!1)}))},cancelPermEdit:function(){this.permModalVisible=!1},loadData:function(e,t){Object(s["vc"])(e.id,{openDataFilter:!1}).then((function(e){e.success&&(e.result.forEach((function(e){e.selected=!1,e.isParent&&(e.loading=!1,e.children=[]),-1==e.status&&(e.title="[已禁用] "+e.title,e.disabled=!0)})),t(e.result))}))},editDep:function(e){var t=this;this.dataType=0,this.editRolePermId=e.id,this.modalTitle="分配 "+e.name+" 的数据权限",e.dataType&&(this.dataType=e.dataType);var i=e.departments;this.editDepartments=i,this.depTreeLoading=!0,Object(s["tc"])({openDataFilter:!1}).then((function(e){t.depTreeLoading=!1,e.success&&(e.result.forEach((function(e){e.selected=!1,e.isParent&&(e.loading=!1,e.children=[]),-1==e.status&&(e.title="[已禁用] "+e.title,e.disabled=!0)})),t.depData=e.result,t.checkDepTree(t.depData,i))})),this.depModalVisible=!0},expandCheckDep:function(e){this.checkDepTree(e.children,this.editDepartments)},checkDepTree:function(e,t){var i=this;e.forEach((function(e){i.hasDepPerm(e,t)?e.selected=!0:e.selected=!1}))},hasDepPerm:function(e,t){for(var i=!1,a=0;a<t.length;a++)if(e.id==t[a].departmentId){i=!0;break}return!!i},submitDepEdit:function(){var e=this,t="";if(1==this.dataType){var i=this.$refs.depTree.getSelectedNodes();i.forEach((function(e){t+=e.id+","})),t=t.substring(0,t.length-1)}this.submitDepLoading=!0,Object(s["ob"])({roleId:this.editRolePermId,dataType:this.dataType,depIds:t}).then((function(t){e.submitDepLoading=!1,t.success&&(e.$Message.success("操作成功"),e.getDataList(),e.depModalVisible=!1)}))},changeOpen:function(e){"0"==e?this.permData.forEach((function(e){e.expand=!0,e.children&&e.children.length>0&&e.children.forEach((function(e){e.expand=!0,e.children&&e.children.length>0&&e.children.forEach((function(e){e.expand=!0}))}))})):"1"==e?this.permData.forEach((function(e){e.expand=!1,e.children&&e.children.length>0&&e.children.forEach((function(e){e.expand=!1,e.children&&e.children.length>0&&e.children.forEach((function(e){e.expand=!1}))}))})):"2"==e?this.permData.forEach((function(e){e.expand=!0,e.children&&e.children.length>0&&e.children.forEach((function(e){e.expand=!1,e.children&&e.children.length>0&&e.children.forEach((function(e){e.expand=!1}))}))})):"3"==e&&this.permData.forEach((function(e){e.expand=!0,e.children&&e.children.length>0&&e.children.forEach((function(e){e.expand=!0,e.children&&e.children.length>0&&e.children.forEach((function(e){e.expand=!1}))}))}))}},mounted:function(){this.init()}},r=l,c=(i("4261"),i("2877")),d=Object(c["a"])(r,a,n,!1,null,null,null);t["default"]=d.exports},4261:function(e,t,i){"use strict";i("b53e")},b53e:function(e,t,i){}}]);