(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-144fef9a"],{a4b3:function(e,t,s){"use strict";s("f3df")},f0c3:function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"message-main-con"},[s("div",{staticClass:"message-mainlist-con"},[s("div",[s("Button",{attrs:{size:"large",long:"",type:"text"},on:{click:function(t){return e.setCurrentMesType("unread")}}},[s("div",{staticClass:"mes-wrap"},[s("transition",{attrs:{name:"mes-current-type-btn"}},[s("Icon",{directives:[{name:"show",rawName:"v-show",value:"unread"==e.currentMessageType,expression:"currentMessageType == 'unread'"}],attrs:{type:"md-checkmark"}})],1),s("span",{staticClass:"mes-type-btn-text"},[e._v("未读消息")]),s("Badge",{staticClass:"message-count-badge-outer",attrs:{"class-name":"message-count-badge-red",count:e.unreadCount}})],1)])],1),s("div",[s("Button",{attrs:{size:"large",long:"",type:"text"},on:{click:function(t){return e.setCurrentMesType("hasread")}}},[s("div",{staticClass:"mes-wrap"},[s("transition",{attrs:{name:"mes-current-type-btn"}},[s("Icon",{directives:[{name:"show",rawName:"v-show",value:"hasread"==e.currentMessageType,expression:"currentMessageType == 'hasread'"}],attrs:{type:"md-checkmark"}})],1),s("span",{staticClass:"mes-type-btn-text"},[e._v("已读消息")]),s("Badge",{staticClass:"message-count-badge-outer",attrs:{"class-name":"message-count-badge",count:e.hasreadCount}})],1)])],1)]),s("div",{staticClass:"message-content-con"},[s("transition",{attrs:{name:"view-message"}},[e.showMesTitleList?s("div",{staticClass:"message-title-list-con"},[s("Table",{ref:"messageList",attrs:{loading:e.loading,columns:e.mesTitleColumns,data:e.currentMesList,"no-data-text":e.noDataText}}),s("div",{staticClass:"message-page"},["unread"==e.currentMessageType?s("Poptip",{attrs:{confirm:"",transfer:"",title:"确定标记所有消息为已读？"},on:{"on-ok":e.readAll}},[s("Button",{attrs:{icon:"md-notifications-off",disabled:e.unreadCount<=0}},[e._v("全部标记为已读")])],1):e._e(),"hasread"==e.currentMessageType?s("Poptip",{attrs:{confirm:"",transfer:"",title:"确定彻底删除所有已读消息？"},on:{"on-ok":e.deleteAll}},[s("Button",{attrs:{icon:"md-trash",disabled:e.hasreadCount<=0}},[e._v("全部彻底删除")])],1):e._e(),s("Page",{staticClass:"page-fix",attrs:{current:e.params.pageNumber,total:e.total,"page-size":e.params.pageSize,"page-size-opts":[5,10],size:"small","show-total":"","show-elevator":"","show-sizer":""},on:{"on-change":e.changePage,"on-page-size-change":e.changePageSize}})],1)],1):e._e()]),s("transition",{attrs:{name:"back-message-list"}},[e.showMesTitleList?e._e():s("div",{staticClass:"message-view-content-con"},[s("div",{staticClass:"message-content-top-bar"},[s("span",{staticClass:"mes-back-btn-con"},[s("Button",{attrs:{type:"text"},on:{click:e.backMesTitleList}},[s("Icon",{attrs:{type:"ios-arrow-back"}}),e._v(" 返回 ")],1)],1),s("h3",{staticClass:"mes-title"},[e._v(e._s(e.mes.title))])]),s("p",{staticClass:"mes-time-con"},[s("Icon",{attrs:{type:"android-time"}}),e._v(" "+e._s(e.mes.time)+" ")],1),s("div",{staticClass:"message-content-body"},[s("p",{staticClass:"message-content",domProps:{innerHTML:e._s(e.mes.content)}},[e._v(" "+e._s(e.mes.content)+" ")])])])])],1)])},n=[],i=s("be65"),r=s.n(i),o=s("365c"),c={name:"message_index",data:function(){var e=this,t=function(t,s){return t("Button",{props:{icon:"md-eye-off",size:"small"},on:{click:function(){var t=s.row;for(var a in t)null==t[a]&&(t[a]="");var n=JSON.stringify(t),i=JSON.parse(n);i.status=1,e.loading=!0,Object(o["hb"])(i).then((function(t){e.loading=!1,t.success&&(e.$Message.success("操作成功"),e.unreadCount-=1,e.hasreadCount+=1,e.$store.commit("setMessageCount",e.unreadCount),e.refreshMessage())}))}}},"标为已读")},s=function(t,s){return t("Button",{props:{icon:"md-trash",size:"small"},on:{click:function(){var t=s.row;e.loading=!0,Object(o["K"])({ids:t.id}).then((function(t){e.loading=!1,t.success&&(e.$Message.success("操作成功"),e.recyclebinCount-=1,e.refreshMessage())}))}}},"删除")};return{loading:!0,params:{userId:JSON.parse(r.a.get("userInfo")).id,status:0,pageNumber:1,pageSize:10,sort:"createTime",order:"desc"},total:0,totalUnread:0,totalRead:0,totalRemove:0,currentMesList:[],currentMessageType:"unread",showMesTitleList:!0,unreadCount:0,hasreadCount:0,recyclebinCount:0,noDataText:"暂无未读消息",mes:{title:"",time:"",content:""},dictMessageType:this.$store.state.dict.messageType,mesTitleColumns:[{type:"index",width:60,align:"center"},{title:" ",key:"title",align:"left",ellipsis:!0,render:function(t,s){return t("span",[t("a",{style:{margin:"0 30px 0 0"},on:{click:function(){e.getContent(s.row)}}},"【"+s.row.type+"】 "+s.row.title)])}},{title:" ",key:"time",align:"center",width:190,render:function(e,t){return e("span",[e("Icon",{props:{type:"md-time",size:16},style:{margin:"0 5px 3px 0"}}),e("span",t.row.createTime)])}},{title:" ",key:"asread",align:"center",width:210,render:function(a,n){return"unread"==e.currentMessageType?a("div",[t(a,n)]):"hasread"==e.currentMessageType?a("div",[s(a,n)]):void 0}}]}},methods:{changePage:function(e){this.params.pageNumber=e,this.refreshMessage()},changePageSize:function(e){this.params.pageSize=e,this.refreshMessage()},refreshMessage:function(){var e=this,t=0,s=this.currentMessageType;t="unread"==s?0:"hasread"==s?1:2,this.params.status=t,this.loading=!0,Object(o["Wb"])(this.params).then((function(t){e.loading=!1,t.success&&(e.currentMesList=t.result.content,e.total=t.result.totalElements)}))},initMessage:function(){var e=this;this.params.status=0,Object(o["Wb"])(this.params).then((function(t){t.success&&(e.unreadCount=t.result.totalElements,e.initReadMessage())}))},initReadMessage:function(){var e=this;this.params.status=1,Object(o["Wb"])(this.params).then((function(t){t.success&&(e.hasreadCount=t.result.totalElements,e.initRemoveMessage())}))},initRemoveMessage:function(){var e=this;this.params.status=2,Object(o["Wb"])(this.params).then((function(t){t.success&&(e.recyclebinCount=t.result.totalElements,e.setCurrentMesType("unread"))}))},deleteMessage:function(e){var t=this;Object(o["K"])({ids:e}).then((function(e){e.success&&t.$Message.success("删除成功")}))},backMesTitleList:function(){this.showMesTitleList=!0},setCurrentMesType:function(e){this.currentMessageType!==e&&(this.showMesTitleList=!0),this.currentMessageType=e,"unread"==e?this.noDataText="暂无未读消息":"hasread"==e&&(this.noDataText="暂无已读消息"),this.params.pageNumber=1,this.refreshMessage()},getContent:function(e){var t=this;if(this.showMesTitleList=!1,this.mes.title=e.title,this.mes.time=e.createTime,this.mes.content=e.content,0==e.status){for(var s in e)null==e[s]&&(e[s]="");var a=JSON.stringify(e),n=JSON.parse(a);n.status=1,Object(o["hb"])(n).then((function(e){e.success&&(t.unreadCount-=1,t.hasreadCount+=1,t.$store.commit("setMessageCount",t.unreadCount),t.refreshMessage())}))}},readAll:function(){var e=this;Object(o["q"])(0).then((function(t){t.success&&(e.hasreadCount+=e.unreadCount,e.unreadCount=0,e.$store.commit("setMessageCount",e.unreadCount),e.refreshMessage())}))},deleteAll:function(){var e=this;Object(o["q"])(1).then((function(t){t.success&&(e.hasreadCount=0,e.refreshMessage())}))}},mounted:function(){this.initMessage()},watch:{$route:function(e,t){"message_index"==e.name&&this.initMessage()}}},u=c,l=(s("a4b3"),s("2877")),d=Object(l["a"])(u,a,n,!1,null,null,null);t["default"]=d.exports},f3df:function(e,t,s){}}]);