(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6cb06f26","chunk-b74fa51c","chunk-2d0de505"],{1087:function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"user-choose"},[s("Button",{attrs:{icon:e.icon},on:{click:function(t){e.userModalVisible=!0}}},[e._v(e._s(e.text))]),s("span",{staticClass:"clear",on:{click:e.clearSelectData}},[e._v("清空已选")]),s("Collapse",{staticClass:"collapse",attrs:{simple:""}},[s("Panel",{attrs:{name:"1"}},[e._v(" 已选择 "),s("span",{staticClass:"select-count"},[e._v(e._s(e.selectUsers.length))]),e._v(" 人 "),s("p",{attrs:{slot:"content"},slot:"content"},e._l(e.selectUsers,(function(t,a){return s("Tag",{key:a,attrs:{name:t.id,color:"default",closable:""},on:{"on-close":e.handleCancelUser}},[s("Tooltip",{attrs:{placement:"top",content:t.username}},[e._v(e._s(t.nickname))])],1)})),1)])],1),s("Drawer",{attrs:{title:"选择用户",closable:"",width:"800",draggable:""},model:{value:e.userModalVisible,callback:function(t){e.userModalVisible=t},expression:"userModalVisible"}},[s("Form",{ref:"searchUserForm",attrs:{model:e.searchUserForm,inline:"","label-width":55}},[s("FormItem",{attrs:{label:"用户名",prop:"nickname"}},[s("Input",{staticStyle:{width:"200px"},attrs:{type:"text",clearable:"",placeholder:"请输入用户名"},model:{value:e.searchUserForm.nickname,callback:function(t){e.$set(e.searchUserForm,"nickname",t)},expression:"searchUserForm.nickname"}})],1),s("FormItem",{attrs:{label:"部门",prop:"department"}},[s("department-choose",{ref:"dep",staticStyle:{width:"200px"},on:{"on-change":e.handleSelectDep}})],1),s("FormItem",{staticClass:"br",staticStyle:{"margin-left":"-35px"}},[s("Button",{attrs:{type:"primary",icon:"ios-search"},on:{click:e.handleSearchUser}},[e._v("搜索")]),s("Button",{on:{click:e.handleResetUser}},[e._v("重置")])],1)],1),s("Alert",{attrs:{"show-icon":""}},[e._v(" 已选择 "),s("span",{staticClass:"select-count"},[e._v(e._s(e.selectUsers.length))]),e._v(" 项 "),s("a",{staticStyle:{"margin-left":"10px"},on:{click:e.clearSelectData}},[e._v("清空已选")])]),s("Table",{staticStyle:{margin:"2vh 0"},attrs:{loading:e.userLoading,border:"",columns:e.userColumns,data:e.userData}}),s("Row",{attrs:{type:"flex",justify:"end"}},[s("Page",{attrs:{current:e.searchUserForm.pageNumber,total:e.totalUser,"page-size":e.searchUserForm.pageSize,"page-size-opts":[10,20,50],size:"small","show-total":"","show-elevator":"","show-sizer":"",transfer:""},on:{"on-change":e.changeUserPage,"on-page-size-change":e.changeUserPageSize}})],1)],1)],1)},r=[],n=s("365c"),i=s("84b5"),l={name:"userChoose",components:{departmentChoose:i["default"]},props:{text:{type:String,default:"选择用户"},icon:{type:String,default:"md-person-add"}},data:function(){var e=this;return{userLoading:!0,userModalVisible:!1,selectUsers:[],searchUserForm:{id:"",nickname:"",type:"",status:"",pageNumber:1,pageSize:10,sort:"createTime",order:"desc"},userColumns:[{type:"index",width:60,align:"center"},{title:"用户名",key:"nickname",minWidth:130,sortable:!0},{title:"登录账号",key:"username",minWidth:130,sortable:!0},{title:"头像",key:"avatar",width:80,align:"center",render:function(e,t){return e("Avatar",{props:{src:t.row.avatar}})}},{title:"所属部门",key:"departmentTitle",width:120},{title:"手机",key:"mobile",width:125,sortable:!0},{title:"邮箱",key:"email",width:180,sortable:!0},{title:"性别",key:"sex",width:70,align:"center"},{title:"创建时间",key:"createTime",sortable:!0,sortType:"desc",width:170},{title:"操作",key:"action",width:130,align:"center",fixed:"right",render:function(t,s){return t("div",[t("Button",{props:{type:"info",size:"small"},on:{click:function(){e.chooseUser(s.row)}}},"添加该用户")])}}],userData:[],totalUser:0}},methods:{handleSelectDep:function(e){this.searchUserForm.departmentId=e},changeUserPage:function(e){this.searchUserForm.pageNumber=e,this.getUserDataList()},changeUserPageSize:function(e){this.searchUserForm.pageSize=e,this.getUserDataList()},getUserDataList:function(){var e=this;this.userLoading=!0,Object(n["oc"])(this.searchUserForm).then((function(t){e.userLoading=!1,t.success&&(e.userData=t.result.content,e.totalUser=t.result.totalElements)}))},handleSearchUser:function(){this.searchUserForm.pageNumber=1,this.searchUserForm.pageSize=10,this.getUserDataList()},handleResetUser:function(){this.$refs.searchUserForm.resetFields(),this.searchUserForm.pageNumber=1,this.searchUserForm.pageSize=10,this.$refs.dep.clearSelect(),this.searchUserForm.departmentId="",this.getUserDataList()},setData:function(e){this.selectUsers=e,this.$emit("on-change",this.selectUsers)},chooseUser:function(e){var t=this,s=!0;if(this.selectUsers.forEach((function(a){e.id==a.id&&(t.$Message.warning("已经添加过啦，请勿重复选择"),s=!1)})),s){var a={id:e.id,username:e.username,nickname:e.nickname};this.selectUsers.push(a),this.$emit("on-change",this.selectUsers),this.$Message.success("添加用户 ".concat(e.nickname," 成功"))}},clearSelectData:function(){this.selectUsers=[],this.$emit("on-change",this.selectUsers)},handleCancelUser:function(e,t){this.selectUsers=this.selectUsers.filter((function(e){return e.id!=t})),this.$emit("on-change",this.selectUsers),this.$Message.success("删除所选用户成功")}},mounted:function(){this.getUserDataList()}},o=l,c=(s("5d34"),s("2877")),u=Object(c["a"])(o,a,r,!1,null,null,null);t["default"]=u.exports},"5d34":function(e,t,s){"use strict";s("cc94")},"5e40":function(e,t,s){"use strict";s("d01b")},"6b62":function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("Card",[s("div",{attrs:{slot:"title"},slot:"title"},[s("div",{staticClass:"edit-head"},[s("a",{staticClass:"back-title",on:{click:e.close}},[s("Icon",{attrs:{type:"ios-arrow-back"}}),e._v("返回 ")],1),s("div",{staticClass:"head-name"},[e._v(e._s(0==e.type?"发送新消息":"编辑消息"))]),s("span"),s("a",{staticClass:"window-close",on:{click:e.close}},[s("Icon",{staticClass:"ivu-icon-ios-close",attrs:{type:"ios-close",size:"31"}})],1)])]),s("Row",[s("Form",{ref:"form",staticStyle:{position:"relative"},attrs:{model:e.form,"label-width":90,rules:e.formValidate}},[s("FormItem",{attrs:{label:"消息类型",prop:"type"}},[s("Select",{staticStyle:{width:"250px"},attrs:{placeholder:"请选择"},model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}},e._l(e.dictMessageType,(function(t,a){return s("Option",{key:a,attrs:{value:t.value}},[e._v(e._s(t.title))])})),1)],1),s("FormItem",{attrs:{label:"标题",prop:"title"}},[s("Input",{staticStyle:{width:"600px"},model:{value:e.form.title,callback:function(t){e.$set(e.form,"title",t)},expression:"form.title"}})],1),s("FormItem",{staticClass:"form-wangEditor",attrs:{label:"内容",prop:"content"}},[s("editor",{model:{value:e.form.content,callback:function(t){e.$set(e.form,"content",t)},expression:"form.content"}})],1),s("FormItem",{attrs:{label:"新创建账号也推送",prop:"createSend"}},[s("i-switch",{attrs:{size:"large"},model:{value:e.form.createSend,callback:function(t){e.$set(e.form,"createSend",t)},expression:"form.createSend"}},[s("span",{attrs:{slot:"open"},slot:"open"},[e._v("开启")]),s("span",{attrs:{slot:"close"},slot:"close"},[e._v("关闭")])])],1),0==e.type?s("div",[s("FormItem",{attrs:{label:"发送范围"}},[s("RadioGroup",{model:{value:e.form.range,callback:function(t){e.$set(e.form,"range",t)},expression:"form.range"}},[s("Radio",{attrs:{label:0}},[e._v("全体用户")]),s("Radio",{attrs:{label:1}},[e._v("指定用户成员")])],1)],1),s("div",[1==e.form.range?s("FormItem",{attrs:{label:"选择用户"}},[s("user-choose",{ref:"user",attrs:{text:"选择发送用户"},on:{"on-change":e.handleSelectUser}})],1):e._e()],1)],1):e._e(),s("FormItem",{staticClass:"br"},[s("Button",{staticStyle:{width:"100px"},attrs:{type:"primary",loading:e.submitLoading},on:{click:e.handelSubmit}},[e._v("提交")]),s("Button",{on:{click:e.close}},[e._v("取消")])],1),e.loading?s("Spin",{attrs:{size:"large",fix:""}}):e._e()],1)],1)],1)],1)},r=[],n=s("365c"),i=s("2c35"),l=s("1087"),o={name:"add_edit_message",components:{userChoose:l["default"],editor:i["default"]},props:{transferData:Object},data:function(){return{type:0,loading:!1,selectUsers:[],userModalVisible:!1,modalTitle:"",form:{title:"",content:"",type:"",range:0},formValidate:{type:[{required:!0,message:"消息类型不能为空",trigger:"change"}],title:[{required:!0,message:"标题不能为空",trigger:"change"}],content:[{required:!0,message:"内容不能为空",trigger:"change"}]},submitLoading:!1,dictMessageType:this.$store.state.dict.messageType,backRoute:""}},methods:{init:function(){this.type=this.transferData.type,1==this.type&&(this.form.id=this.transferData.id,this.getData())},getData:function(){var e=this;this.loading=!0,Object(n["Vb"])(this.form.id).then((function(t){if(e.loading=!1,t.success){var s=t.result;for(var a in s)null==s[a]&&(s[a]="");var r=JSON.stringify(s),n=JSON.parse(r);e.form=n}}))},handelSubmit:function(){var e=this;this.$refs.form.validate((function(t){if(t)if(e.submitLoading=!0,0==e.type){delete e.form.id;var s=[];e.selectUsers.forEach((function(e){s+=e.id+","})),s.length>0&&(s=s.substring(0,s.length-1)),e.form.userIds=s,Object(n["j"])(e.form).then((function(t){e.submitLoading=!1,t.success&&(e.$Message.success("操作成功"),e.submited())}))}else 1==e.type&&Object(n["gb"])(e.form).then((function(t){e.submitLoading=!1,t.success&&(e.$Message.success("操作成功"),e.submited())}))}))},handleSelectUser:function(e){this.selectUsers=e},close:function(){this.$emit("close",!0)},submited:function(){this.$emit("submited",!0)}},mounted:function(){this.init()}},c=o,u=(s("5e40"),s("2877")),d=Object(u["a"])(c,a,r,!1,null,null,null);t["default"]=d.exports},"84b5":function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("Cascader",{attrs:{data:e.department,"load-data":e.loadData,"change-on-select":"",filterable:"",clearable:"",placeholder:"请选择或输入搜索部门"},on:{"on-change":e.handleChangeDep},model:{value:e.selectDep,callback:function(t){e.selectDep=t},expression:"selectDep"}})],1)},r=[],n=s("365c"),i={name:"departmentChoose",props:{},data:function(){return{selectDep:[],department:[]}},methods:{initDepartmentData:function(){var e=this;Object(n["tc"])().then((function(t){t.success&&(t.result.forEach((function(e){e.isParent?(e.value=e.id,e.label=e.title,e.loading=!1,e.children=[]):(e.value=e.id,e.label=e.title),-1==e.status&&(e.label="[已禁用] "+e.label,e.disabled=!0)})),e.department=t.result)}))},loadData:function(e,t){e.loading=!0,Object(n["vc"])(e.value).then((function(s){e.loading=!1,s.success&&(s.result.forEach((function(e){e.isParent?(e.value=e.id,e.label=e.title,e.loading=!1,e.children=[]):(e.value=e.id,e.label=e.title),-1==e.status&&(e.label="[已禁用] "+e.label,e.disabled=!0)})),e.children=s.result,t())}))},handleChangeDep:function(e,t){var s="";e&&e.length>0&&(s=e[e.length-1]),this.$emit("on-change",s)},clearSelect:function(){this.selectDep=[]}},mounted:function(){this.initDepartmentData()}},l=i,o=s("2877"),c=Object(o["a"])(l,a,r,!1,null,null,null);t["default"]=c.exports},cc94:function(e,t,s){},d01b:function(e,t,s){}}]);